<cr-expansion-panel expanded="true">
	<cr-expansion-panel-title>SCAN PROPERTIES</cr-expansion-panel-title>
	<cr-expansion-panel-menu>
		<cr-expansion-panel-menu-item *ngIf="help">
			<button mat-button
							matTooltip="Help"
							(click)="helpClicked($event)">
				<mat-icon>help_outline</mat-icon>
			</button>
		</cr-expansion-panel-menu-item>
		<cr-expansion-panel-menu-item *ngIf="share">
			<button mat-button
							matTooltip="Share"
							(click)="shareClicked($event)">
				<mat-icon>share</mat-icon>
			</button>
		</cr-expansion-panel-menu-item>
		<cr-expansion-panel-menu-item *ngIf="download">
			<button mat-button
							matTooltip="Download"
							(click)="downloadClicked($event)">
				<mat-icon>save_alt</mat-icon>
			</button>
		</cr-expansion-panel-menu-item>
		<cr-expansion-panel-menu-item>
			<button mat-button
							matTooltip="Settings"
							(click)="openSettingsDialog()">
				<mat-icon>settings</mat-icon>
			</button>
		</cr-expansion-panel-menu-item>
	</cr-expansion-panel-menu>
	<cr-expansion-panel-body fxLayout="row nowrap">
		<!-- PROGRESS -->
		<div prop>
			<ng-container>
				<div fxLayout="row nowrap"
						 fxLayoutAlign="center center"
						 fxLayoutGap="1em">
					<div fxLayout="row nowrap"
							 *ngIf="!done"
							 fxLayoutAlign="center center">
						<div header>&zwnj;</div>
						<mat-spinner [diameter]="40"></mat-spinner>
					</div>
					<div>
						<div header>
							<ng-container *ngIf="!done && progress !== null">
								{{ progress && progress / 100 | percent: '1.0' }}
							</ng-container>
							<ng-container *ngIf="done">done</ng-container>
						</div>
					</div>
				</div>
				<div>
					<ng-container *ngIf="isScanning && !done">
						Scanning...
					</ng-container>
					<ng-container *ngIf="!isScanning && !done">
						Loading...
					</ng-container>
					<ng-container *ngIf="done">
						<div *ngIf="metadata"
								 [matTooltip]="metadata?.scannedDocument.creationTime | date: 'MMMM d, y, h:mm:ss a'">
							Scanned {{ metadata?.scannedDocument.creationTime | timeAgo }}
						</div>
					</ng-container>
				</div>
			</ng-container>
		</div>

		<!-- RESULTS FOUND -->
		<div prop>
			<div header
					 [matTooltip]="previewCount >= 1000 ? (previewCount | number) + ' results' : null">
				{{ previewCount | shortNumber: 1 }}
			</div>
			<div>
				results found
			</div>
		</div>

		<!-- # COPIED WORDS -->
		<div prop
				 *ngIf="stats; else skeleton__prop">
			<div header
					 [matTooltip]="combined >= 1000 ? (combined | number) + ' words' : null">
				{{ combined | shortNumber: 1 }}

			</div>
			<div>similar words</div>
		</div>

		<!-- STATS -->
		<div stats
				 [fxFlexOrder.lt-md]="-5"
				 fxLayout="row nowrap"
				 fxLayoutAlign="stretch stretch">
			<ng-container *ngIf="stats; else skeleton__stats">
				<ngx-charts-pie-chart fxHide.lt-md
															[customColors]="customColors"
															[results]="chartData"
															[view]="[150, 150]">
					<ng-template #tooltipTemplate
											 let-model="model">
						<div style="padding:0.5em"
								 class="mat-typography">
							<span style="font-size:1em;display: block">{{ model.value | number }}</span>
							<span tooltip-text>{{ model.name }} words</span>
						</div>
					</ng-template>
				</ngx-charts-pie-chart>

				<div legend
						 fxLayout="column"
						 fxFlex
						 fxLayoutAlign="space-evenly stretch">
					<div row
							 (click)="toggleComparison('showIdentical')"
							 [matTooltip]="options?.showIdentical ? null : 'Omitted by your configuration. Click to enable'"
							 fxLayout="row"
							 fxLayoutAlign="start center"
							 fxLayoutGap="0.5em">
						<div class="dot identical"
								 [ngStyle]="{'visibility': options?.showIdentical? 'visible':'hidden'}"></div>
						<div text
								 [ngClass]="{ 'cr-strike-out': !options?.showIdentical }">
							Identical
						</div>
						<span fxFlex></span>

						<div *ngIf="options.showIdentical || stats.identical > 0">
							{{ stats?.identical / stats?.total | similarity: '1.0-1' }}
						</div>
					</div>
					<mat-divider></mat-divider>
					<div row
							 (click)="toggleComparison('showMinorChanges')"
							 [matTooltip]="options?.showMinorChanges ? null : 'Omitted by your configuration. Click to enable'"
							 fxLayout="row"
							 fxLayoutAlign="center center"
							 fxLayoutGap="0.5em">
						<div class="dot minor-changes"
								 [ngStyle]="{'visibility': options?.showMinorChanges ? 'visible':'hidden'}"></div>
						<div text
								 [ngClass]="{ 'cr-strike-out': options?.showMinorChanges !== true }">
							Minor Changes
						</div>
						<span fxFlex></span>
						<div *ngIf="options.showMinorChanges || stats.minorChanges > 0">
							{{ stats?.minorChanges / stats?.total | percent: '1.0-1' }}
						</div>
					</div>
					<mat-divider></mat-divider>
					<div row
							 (click)="toggleComparison('showRelated')"
							 [matTooltip]="options?.showRelated ? null : 'Omitted by your configuration. Click to enable'"
							 fxLayout="row"
							 fxLayoutAlign="start center"
							 fxLayoutGap="0.5em">
						<div class="dot related"
								 [ngStyle]="{'visibility': options?.showRelated?  'visible':'hidden'}"></div>
						<div text
								 [ngClass]="{ 'cr-strike-out': options?.showRelated !== true }">
							Related Meaning
						</div>
						<span fxFlex></span>
						<div *ngIf="options.showRelated || stats.relatedMeaning > 0">
							{{ stats?.relatedMeaning / stats?.total | percent: '1.0-1' }}
						</div>
					</div>
					<mat-divider></mat-divider>
					<div row
							 fxLayout="row"
							 fxLayoutAlign="start center"
							 fxLayoutGap="0.5em">
						<div class="dot omitted"></div>
						<div text>Omitted Words</div>
						<span fxFlex></span>
						<div>
							{{ stats && metadata.scannedDocument.totalExcluded / stats?.total | percent: '1.0-1' }}
						</div>
					</div>
				</div>

				<ng-template #statsSpinner>
					<mat-spinner *ngIf="!stats"
											 [diameter]="16"
											 style="display: inline-block;"></mat-spinner>
				</ng-template>
			</ng-container>
		</div>

		<!-- % MATCH -->
		<div prop
				 *ngIf="stats; else skeleton__prop"
				 [ngClass]="{ low: score <= 0.1, medium: score > 0.1 && score <= 0.5, high: score > 0.5 }">
			<div header>
				{{ score | percent: '1.0-1' }}
			</div>
			<div [matTooltip]="isShowingPartialStats ? 'Some matches are ommited according to your settings' : null">
				match{{ isShowingPartialStats ? '*' : '' }}
			</div>
		</div>
	</cr-expansion-panel-body>
</cr-expansion-panel>

<ng-template #skeleton__prop>
	<div prop>
		<ngx-skeleton-loader [theme]="{ height: '3em', width: '95px', margin: '0.5em' }"></ngx-skeleton-loader>
		<ngx-skeleton-loader [theme]="{ height: '1em', width: '3em' }"></ngx-skeleton-loader>
	</div>
</ng-template>

<ng-template #skeleton__stats>
	<div fxLayout="column">
		<ngx-skeleton-loader [theme]="{ width: '118px', height: '113px', margin: '1em' }"
												 appearance="circle"></ngx-skeleton-loader>
	</div>

	<div fxLayout="column"
			 fxFlex
			 fxLayoutAlign="space-evenly stretch">
		<ng-container *ngFor="let x of 4 | array; let last = last">
			<div fxLayout="row"
					 fxLayoutGap="1em"
					 style="padding:0em 0.5em"
					 fxLayoutAlign="center center">
				<ngx-skeleton-loader appearance="circle"
														 [theme]="{ width: '1.75em', height: '1.75em', margin: '0px' }"></ngx-skeleton-loader>
				<ngx-skeleton-loader [theme]="{ margin: '0', width: '5em' }"></ngx-skeleton-loader>
				<span fxFlex></span>
				<ngx-skeleton-loader [theme]="{ margin: '0', width: '3em' }"></ngx-skeleton-loader>
			</div>
			<mat-divider *ngIf="!last"></mat-divider>
		</ng-container>
	</div>
</ng-template>
